openapi: 3.0.3
info:
  version: 0.10.6
  title: Secrets-Manager API
  description: | 
    This API is a BETA API.
    
    There are no guarantees for stability or compatibility of the API itself. Breaking changes to the APi can happen
    any time.
    
    There are no guarantees for the availability of the resources which are deployed by the API.
    
    Do not use this API for production workload where you cannot tolerate loss of data or unavailability of services.
    
    This API provides endpoints for managing the Secrets-Manager.
x-stackit-api:
  type: stackit
x-stackit-scope:
  visibility: public
servers:
  - url: https://api.dev.sm.eu01.stackit.cloud
    x-stackit-stage: dev
    x-stackit-cors:
      allow_origins:
        - "*"
      allow_headers:
        - Authorization
        - Stackit-Tracking-Id
        - Content-Type
        - Origin
        - Accept
        - token
      allow_methods:
        - GET
        - HEAD
        - POST
        - DELETE
  - url: https://api.qa.sm.eu01.stackit.cloud
    x-stackit-stage: qa
    x-stackit-cors:
      allow_origins:
        - "*"
      allow_headers:
        - Authorization
        - Stackit-Tracking-Id
        - Content-Type
        - Origin
        - Accept
        - token
      allow_methods:
        - GET
        - HEAD
        - POST
        - DELETE
  - url: https://api.sm.eu01.stackit.cloud
    x-stackit-stage: prd

paths:
  /v1/projects/{projectId}/instances:
    parameters:
      - name: projectId
        description: The STACKIT portal project UUID the Secrets Manager instance is part of.
        schema:
          type: string
          format: uuid
          x-go-type: string
        in: path
        required: true
    get:
      description: Returns a list of all Secrets Manager instances within the project.
      responses:
        '200':
          description: Successful response with all instances.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/instanceList'
        '401':
          description: Unauthorized. You may have provided no or wrong credentials.
        '500':
          description: Internal server error. The application experienced some unexpected situation.
      x-stackit-authorization:
        resource-id-type: dynamic
        resource-id: projectId
        resource-type: project
        actions:
          - project.read
      x-stackit-signer:
        audience:
          - sm.eu01.stackit.cloud
    post:
      description: Creates a new Secrets Manager instance within the project.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/instanceCreate'
      responses:
        '201':
          description: Instance was created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/instance'
        '400':
          description: Bad Request. Invalid instance name.
        '401':
          description: Unauthorized. You may have provided no or wrong credentials.
        '500':
          description: Internal server error. The application experienced some unexpected situation.
      x-stackit-authorization:
        resource-id-type: dynamic
        resource-id: projectId
        resource-type: project
        actions:
          - project.resource.write
      x-stackit-signer:
        audience:
          - sm.eu01.stackit.cloud
  /v1/projects/{projectId}/instances/{instanceId}:
    parameters:
      - name: projectId
        description: The STACKIT portal project UUID the Secrets Manager instance is part of.
        schema:
          type: string
          format: uuid
          x-go-type: string
        in: path
        required: true
      - name: instanceId
        description: The Secrets Manager instance UUID.
        schema:
          type: string
          format: uuid
          x-go-type: string
        in: path
        required: true
    get:
      description: Returns the details for the given Secrets Manager instance.
      responses:
        '200':
          description: Instance details successfully retrieved.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/instance'
        '401':
          description: Unauthorized. You may have provided no or wrong credentials.
        '404':
          description: Not found. Instance not found.
        '500':
          description: Internal server error. The application experienced some unexpected situation.
      x-stackit-authorization:
        resource-id-type: dynamic
        resource-id: projectId
        resource-type: project
        actions:
          - project.read
      x-stackit-signer:
        audience:
          - sm.eu01.stackit.cloud
    delete:
      description: Deletes the given Secrets Manager instance.
      responses:
        '204':
          description: Instance was deleted successfully.
        '401':
          description: Unauthorized. You may have provided no or wrong credentials.
        '404':
          description: Not found. Instance not found.
        '500':
          description: Internal server error. The application experienced some unexpected situation.
      x-stackit-authorization:
        resource-id-type: dynamic
        resource-id: projectId
        resource-type: project
        actions:
          - project.resource.write
      x-stackit-signer:
        audience:
          - sm.eu01.stackit.cloud
  /v1/projects/{projectId}/instances/{instanceId}/acls:
    parameters:
      - name: projectId
        description: The STACKIT portal project UUID the Secrets Manager instance is part of.
        schema:
          type: string
          format: uuid
          x-go-type: string
        in: path
        required: true
      - name: instanceId
        description: The Secrets Manager instance UUID.
        schema:
          type: string
          format: uuid
          x-go-type: string
        in: path
        required: true
    get:
      description: Returns the acls for the given Secrets Manager instance.
      responses:
        '200':
          description: All acls for the Secrets Manager instance have been returned.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/aclList'
        '401':
          description: Unauthorized. You may have provided no or wrong credentials.
        '404':
          description: Not found. Instance not found.
        '500':
          description: Internal server error. The application experienced some unexpected situation.
      x-stackit-authorization:
        resource-id-type: dynamic
        resource-id: projectId
        resource-type: project
        actions:
          - project.read
      x-stackit-signer:
        audience:
          - sm.eu01.stackit.cloud
    post:
      description: Creates a new Secrets Manager acl within the project.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/aclCreate'
      responses:
        '201':
          description: Acl was created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/acl'
        '400':
          description: Bad Request. Cidr not valid.
        '401':
          description: Unauthorized. You may have provided no or wrong credentials.
        '404':
          description: Not found. Instance not found.
        '500':
          description: Internal server error. The application experienced some unexpected situation.
      x-stackit-authorization:
        resource-id-type: dynamic
        resource-id: projectId
        resource-type: project
        actions:
          - project.resource.write
      x-stackit-signer:
        audience:
          - sm.eu01.stackit.cloud
  /v1/projects/{projectId}/instances/{instanceId}/acls/{aclId}:
    parameters:
      - name: projectId
        description: The STACKIT portal project UUID the Secrets Manager instance is part of.
        schema:
          type: string
          format: uuid
          x-go-type: string
        in: path
        required: true
      - name: instanceId
        description: The Secrets Manager instance UUID.
        schema:
          type: string
          format: uuid
          x-go-type: string
        in: path
        required: true
      - name: aclId
        description: The acl UUID of the Secrets Manager instance.
        schema:
          type: string
          format: uuid
          x-go-type: string
        in: path
        required: true
    delete:
      description: Deletes the given acl.
      responses:
        '204':
          description: Acl was deleted successfully
        '401':
          description: Unauthorized. You may have provided no or wrong credentials.
        '404':
          description: Not found. Instance or acl not found.
        '500':
          description: Internal server error. The application experienced some unexpected situation.
      x-stackit-authorization:
        resource-id-type: dynamic
        resource-id: projectId
        resource-type: project
        actions:
          - project.resource.write
      x-stackit-signer:
        audience:
          - sm.eu01.stackit.cloud
    get:
      description: Returns the details for the given acl.
      responses:
        '200':
          description: The details for the acl have been successfully returned.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/acl'
        '401':
          description: Unauthorized. You may have provided no or wrong credentials.
        '404':
          description: Not found. Instance or acl not found.
        '500':
          description: Internal server error. The application experienced some unexpected situation.
      x-stackit-authorization:
        resource-id-type: dynamic
        resource-id: projectId
        resource-type: project
        actions:
          - project.read
      x-stackit-signer:
        audience:
          - sm.eu01.stackit.cloud
    put:
      description: Updates the ip ranges for the acl.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/aclUpdate'
      responses:
        '200':
          description: The ip range for the acl have been successfully updated.
        '400':
          description: Bad Request. Cidr not valid.
        '401':
          description: Unauthorized. You may have provided no or wrong credentials.
        '404':
          description: Not found. Instance or acl not found.
        '500':
          description: Internal server error. The application experienced some unexpected situation.
      x-stackit-authorization:
        resource-id-type: dynamic
        resource-id: projectId
        resource-type: project
        actions:
          - project.resource.write
      x-stackit-signer:
        audience:
          - sm.eu01.stackit.cloud
  /v1/projects/{projectId}/instances/{instanceId}/users:
    parameters:
      - name: projectId
        description: The STACKIT portal project UUID the Secrets Manager instance is part of.
        schema:
          type: string
          format: uuid
          x-go-type: string
        in: path
        required: true
      - name: instanceId
        description: The Secrets Manager instance UUID.
        schema:
          type: string
          format: uuid
          x-go-type: string
        in: path
        required: true
    get:
      description: Returns the users for the given Secrets Manager instance.
      responses:
        '200':
          description: All users for the Secrets Manager instance have been returned.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/userList'
        '401':
          description: Unauthorized. You may have provided no or wrong credentials.
        '404':
          description: Not found. Instance not found.
        '500':
          description: Internal server error. The application experienced some unexpected situation.
      x-stackit-authorization:
        resource-id-type: dynamic
        resource-id: projectId
        resource-type: project
        actions:
          - project.read
      x-stackit-signer:
        audience:
          - sm.eu01.stackit.cloud
    post:
      description: Creates a new user for the given Secrets Manager instance.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/userCreate'
      responses:
        '200':
          description: The user has been created for the Secrets Manager instance.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/user'
        '400':
          description: Bad request. User description too long.
        '401':
          description: Unauthorized. You may have provided no or wrong credentials.
        '404':
          description: Not found. Instance not found.
        '409':
          description: Conflict. User limit reached. Contact the support.
        '500':
          description: Internal server error. The application experienced some unexpected situation.
      x-stackit-authorization:
        resource-id-type: dynamic
        resource-id: projectId
        resource-type: project
        actions:
          - project.resource.write
      x-stackit-signer:
        audience:
          - sm.eu01.stackit.cloud
  /v1/projects/{projectId}/instances/{instanceId}/users/{userId}:
    parameters:
      - name: projectId
        description: The STACKIT portal project UUID the Secrets Manager instance is part of.
        schema:
          type: string
          format: uuid
          x-go-type: string
        in: path
        required: true
      - name: instanceId
        description: The Secrets Manager instance UUID.
        schema:
          type: string
          format: uuid
          x-go-type: string
        in: path
        required: true
      - name: userId
        description: The user UUID with permissions on the Secrets Manager instance.
        schema:
          type: string
          format: uuid
          x-go-type: string
        in: path
        required: true
    get:
      description: Returns the details for the given user.
      responses:
        '200':
          description: The details for the user have been successfully returned.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/user'
        '401':
          description: Unauthorized. You may have provided no or wrong credentials.
        '404':
          description: Not found. Instance or user not found.
        '500':
          description: Internal server error. The application experienced some unexpected situation.
      x-stackit-authorization:
        resource-id-type: dynamic
        resource-id: projectId
        resource-type: project
        actions:
          - project.read
      x-stackit-signer:
        audience:
          - sm.eu01.stackit.cloud
    put:
      description: Updates the details for the given user.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/userUpdate'
      responses:
        '200':
          description: The details for the user have been successfully updated.
        '401':
          description: Unauthorized. You may have provided no or wrong credentials.
        '404':
          description: Not found. Instance or user not found.
        '500':
          description: Internal server error. The application experienced some unexpected situation.
      x-stackit-authorization:
        resource-id-type: dynamic
        resource-id: projectId
        resource-type: project
        actions:
          - project.resource.write
      x-stackit-signer:
        audience:
          - sm.eu01.stackit.cloud
    delete:
      description: Deletes the given user.
      responses:
        '204':
          description: Instance was deleted successfully
        '401':
          description: Unauthorized. You may have provided no or wrong credentials.
        '404':
          description: Not found. Instance or user not found.
        '500':
          description: Internal server error. The application experienced some unexpected situation.
      x-stackit-authorization:
        resource-id-type: dynamic
        resource-id: projectId
        resource-type: project
        actions:
          - project.resource.write
      x-stackit-signer:
        audience:
          - sm.eu01.stackit.cloud
components:
  schemas:
    instance:
      required:
        - id
        - name
        - secretsEngine
        - apiUrl
        - state
        - creationStartDate
        - secretCount
      properties:
        id:
          type: string
          description: A auto generated unique id which identifies the secrets manager instances.
        name:
          type: string
          description: A user chosen name to distinguish multiple secrets manager instances.
        secretsEngine:
          type: string
          description: The name of the secrets engine.
        apiUrl:
          type: string
          description: The API endpoint for connecting to the secrets engine.
        state:
          type: string
          description: The current state of the Secrets Manager instance.
        creationStartDate:
          type: string
          description: The date and time the creation of the Secrets Manager instance was triggered.
        creationFinishedDate:
          type: string
          description: The date and time the creation of the Secrets Manager instance was finished.
        updateStartDate:
          type: string
        updateFinishedDate:
          type: string
        secretCount:
          type: integer
          description: The number of secrets currently stored inside of the instance. This value will be updated once per hour.
    instanceList:
      required:
        - instances
      properties:
        instances:
          type: array
          items:
            $ref: '#/components/schemas/instance'
    instanceCreate:
      required:
        - name
      properties:
        name:
          type: string
          description: A user chosen name to distinguish multiple secrets manager instances.
    acl:
      required:
        - id
        - cidr
      properties:
        id:
          type: string
          description: A auto generated unique id which identifies the acl.
        cidr:
          type: string
          description: The given IP/IP Range that is permitted to access.
    aclList:
      required:
        - acls
      properties:
        acls:
          type: array
          items:
            $ref: '#/components/schemas/acl'
    aclCreate:
      required:
        - cidr
      properties:
        cidr:
          type: string
          description: The given IP/IP Range that is permitted to access.
    aclUpdate:
      required:
        - cidr
      properties:
        cidr:
          type: string
          description: The given IP/IP Range that is permitted to access.
    user:
      required:
        - id
        - username
        - password
        - write
        - description
      properties:
        id:
          type: string
          description: A auto generated unique id which identifies the users.
        username:
          type: string
          description: A auto generated username for logging in with the user.
        password:
          type: string
          description: A auto generated password for logging in with the user.
        description:
          type: string
          description: A user chosen description to differentiate between multiple users.
        write:
          type: boolean
          description: Is true if the user has write access to the secrets engine. Is false for a read-only user.
    userList:
      required:
        - users
      properties:
        users:
          type: array
          items:
            $ref: '#/components/schemas/user'
    userCreate:
      required:
        - write
        - description
      properties:
        description:
          type: string
          description: A user chosen description to differentiate between multiple users.
        write:
          type: boolean
          description: Is true if the user has write access to the secrets engine. Is false for a read-only user.
    userUpdate:
      properties:
        write:
          type: boolean
          description: Is true if the user has write access to the secrets engine. Is false for a read-only user.
